---
- name: Start Spring Boot app
  shell: |
    echo "ğŸ” Checking if JAR exists..."
    if [ ! -f /opt/spring-petclinic/spring-petclinic.jar ]; then
      echo "âŒ JAR not found at /opt/spring-petclinic/spring-petclinic.jar"
      exit 1
    fi

    echo "ğŸ§  Checking Java..."
    java -version || echo "âš ï¸ Java check failed (will continue)"

    echo "ğŸ›‘ Stopping any existing process..."
    pkill -f spring-petclinic || true

    echo "ğŸš€ Starting Spring Boot app in background..."
    nohup java -jar /opt/spring-petclinic/spring-petclinic.jar > /opt/spring-petclinic/app.log 2>&1 &
    sleep 10

    echo "ğŸ“‹ Checking process..."
    if pgrep -f spring-petclinic; then
      echo "âœ… App started successfully!"
    else
      echo "âŒ App not running! Showing last 20 lines of log:"
      tail -n 20 /opt/spring-petclinic/app.log || true
    fi
  args:
    executable: /bin/bash
