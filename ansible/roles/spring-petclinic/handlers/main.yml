---
- name: Start Spring Boot app
  shell: |
    echo "ğŸ” Checking if JAR exists..."
    if [ ! -f /opt/spring-petclinic/spring-petclinic.jar ]; then
      echo "âŒ JAR not found at /opt/spring-petclinic/spring-petclinic.jar"
      exit 1
    fi

    echo "ğŸ§  Checking Java..."
    if ! command -v java >/dev/null 2>&1; then
      echo "âŒ Java not found in PATH"
      exit 1
    fi

    echo "ğŸ›‘ Stopping any existing process..."
    pkill -f spring-petclinic || true

    echo "ğŸš€ Starting Spring Boot app..."
    nohup java -jar /opt/spring-petclinic/spring-petclinic.jar > /opt/spring-petclinic/app.log 2>&1 &

    echo "ğŸ• Waiting for startup..."
    sleep 10

    echo "ğŸ“‹ Checking process..."
    if ! pgrep -f spring-petclinic; then
      echo "âŒ App not running! Showing last 20 lines of log:"
      tail -n 20 /opt/spring-petclinic/app.log || true
      exit 1
    else
      echo "âœ… App started successfully!"
    fi
  args:
    executable: /bin/bash
